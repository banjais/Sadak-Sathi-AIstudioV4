<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="copyright" content="Copyright (c) 2024 Your Company or Name. All Rights Reserved.">
    <title>Sadak Sathi - Your Road Companion</title>
    <!-- 2D Map Library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Charting Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- NEW: Redesigned Loading Overlay -->
    <div id="loading-overlay">
        <div class="loading-content">
            <div class="loading-icon-wrapper">
                <svg id="loading-icon" viewBox="0 0 100 100">
                    <circle class="compass-bg" cx="50" cy="50" r="45"/>
                    <path class="compass-needle" d="M 50,15 L 60,50 L 50,85 L 40,50 Z" />
                </svg>
            </div>
            <p id="loading-message" data-lang-key="loading_initializing">Initializing...</p>
        </div>
    </div>

    <div id="app-container" data-theme="light" data-mode="driving">
        <div id="map"></div>
        
        <!-- App Header -->
        <header id="app-header">
            <div class="header-left">
                <div class="app-title">
                    <h1>Sadak Sathi</h1>
                    <p class="app-subtitle" data-lang-key="app_subtitle">Your Road Companion</p>
                </div>
                <div id="gps-status-indicator" title="GPS Status: Searching..."></div>
                <p id="gps-status-text" data-lang-key="gps_searching" class="hidden">GPS Status: Searching...</p>
            </div>
            <div class="header-right">
                <!-- NEW: Notifications Bell for Admins -->
                <div id="notifications-container" class="hidden">
                    <button id="notifications-btn" class="icon-button" title="Notifications">
                        <span class="material-icons">notifications</span>
                        <span id="notifications-badge" class="badge hidden"></span>
                    </button>
                    <div id="notifications-panel" class="hidden">
                        <div class="panel-header" style="padding: 0.75rem 1rem;">
                            <h4>Notifications</h4>
                        </div>
                        <ul id="notifications-list">
                           <!-- Notifications will be injected here -->
                           <p class="no-notifications">No new notifications.</p>
                        </ul>
                    </div>
                </div>

                <button id="live-cam-btn" class="icon-button" title="Live Cam">
                    <span class="material-icons">videocam</span>
                </button>
                 <button id="theme-toggle" class="icon-button" data-lang-key-aria-label="toggle_dark_mode" title="Toggle dark mode">
                    <span class="material-icons">light_mode</span>
                </button>
                <div id="language-selector-container">
                    <button id="language-selector-btn" aria-haspopup="true" aria-expanded="false">
                        <span class="material-icons colorful-globe">language</span>
                        <span id="current-lang-label">English</span>
                        <span class="material-icons">arrow_drop_down</span>
                    </button>
                    <!-- NEW: Rebuilt Language Popup -->
                    <div id="language-popup" class="hidden" role="menu">
                        <div class="lang-tabs">
                            <button class="lang-tab-btn active" data-tab="national" title="National Languages">
                                <span class="lang-tab-icon">ðŸ‡³ðŸ‡µ</span>
                                <span data-lang-key="lang_cat_national">National</span>
                            </button>
                            <button class="lang-tab-btn" data-tab="international" title="International Languages">
                                <span class="lang-tab-icon material-icons">language</span>
                                <span data-lang-key="lang_cat_international">International</span>
                            </button>
                        </div>
                        <div id="lang-panel-national" class="lang-panel active">
                            <button class="lang-option" role="menuitem" data-lang="np">Nepali</button>
                            <button class="lang-option" role="menuitem" data-lang="new">Newar</button>
                            <button class="lang-option" role="menuitem" data-lang="mth">Maithili</button>
                            <button class="lang-option" role="menuitem" data-lang="bjp">Bhojpuri</button>
                            <button class="lang-option" role="menuitem" data-lang="th">Tharu</button>
                            <button class="lang-option" role="menuitem" data-lang="tm">Tamang</button>
                            <button class="lang-option" role="menuitem" data-lang="mg">Magar</button>
                            <button class="lang-option" role="menuitem" data-lang="dot">Doteli</button>
                        </div>
                        <div id="lang-panel-international" class="lang-panel">
                            <button class="lang-option active" role="menuitem" data-lang="en">English</button>
                            <button class="lang-option" role="menuitem" data-lang="es">Spanish</button>
                            <button class="lang-option" role="menuitem" data-lang="fr">French</button>
                            <button class="lang-option" role="menuitem" data-lang="de">German</button>
                            <button class="lang-option" role="menuitem" data-lang="it">Italian</button>
                            <button class="lang-option" role="menuitem" data-lang="zh">Chinese</button>
                            <button class="lang-option" role="menuitem" data-lang="ja">Japanese</button>
                            <button class="lang-option" role="menuitem" data-lang="ko">Korean</button>
                            <button class="lang-option" role="menuitem" data-lang="ar">Arabic</button>
                            <button class="lang-option" role="menuitem" data-lang="ru">Russian</button>
                            <button class="lang-option" role="menuitem" data-lang="hi">Hindi</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Proactive Alert Banner -->
        <div id="proactive-alert" class="hidden">
            <span class="material-icons alert-icon">campaign</span>
            <p id="alert-message"></p>
            <div class="alert-actions">
                <button id="alert-ask-ai-btn" class="alert-btn" data-lang-key="alert_ask_ai">Ask AI</button>
                <button id="alert-close-btn" class="icon-button" data-lang-key-aria-label="alert_dismiss">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>
        
        <!-- Map Overlays (Controls) -->
        <div id="map-overlays-top-right">
            <div id="map-controls-container">
                <button id="zoom-in-btn" class="map-control-button" title="Zoom In"><span class="material-icons">add</span></button>
                <button id="zoom-out-btn" class="map-control-button" title="Zoom Out"><span class="material-icons">remove</span></button>
                <button id="center-location-btn" class="map-control-button" data-lang-key-title="center_location"><span class="material-icons">my_location</span></button>
                <button id="toggle-heading-up-btn" class="map-control-button" title="Toggle Heading Up View"><span class="material-icons">explore</span></button>
                <button id="measure-distance-btn" class="map-control-button" title="Measure Distance"><span class="material-icons">straighten</span></button>
                <button id="travel-time-btn" class="map-control-button" title="Travel Time Map"><span class="material-icons">timer</span></button>
                <div id="map-options-selector">
                    <button id="map-options-btn" class="map-control-button" title="Map Options"><span class="material-icons">layers</span></button>
                    <div id="map-options-popup" class="hidden">
                         <div class="map-options-section">
                            <h4 data-lang-key="layers">Data Layers</h4>
                            <div class="layer-toggle">
                                <label for="toggle-roads" data-lang-key="roads">Roads</label>
                                <input type="checkbox" id="toggle-roads" class="toggle-switch" checked>
                            </div>
                            <!-- NEW: Road Hierarchy Filters -->
                            <div id="road-filters-container">
                                <div class="road-filter-toggle">
                                    <label for="filter-road-highways">National Highways</label>
                                    <input type="checkbox" id="filter-road-highways" class="toggle-switch" data-road-category="national_highway" checked>
                                </div>
                                <div class="road-filter-toggle">
                                    <label for="filter-road-major">Major Roads</label>
                                    <input type="checkbox" id="filter-road-major" class="toggle-switch" data-road-category="major_road" checked>
                                </div>
                                <div class="road-filter-toggle">
                                    <label for="filter-road-local">Local Roads</label>
                                    <input type="checkbox" id="filter-road-local" class="toggle-switch" data-road-category="local_road" checked>
                                </div>
                            </div>
                            <div class="layer-toggle">
                                <label for="toggle-pois" data-lang-key="pois">Points of Interest</label>
                                <input type="checkbox" id="toggle-pois" class="toggle-switch" checked>
                            </div>
                            <div class="layer-toggle">
                                <label for="toggle-incidents" data-lang-key="incidents">Live Alerts</label>
                                <input type="checkbox" id="toggle-incidents" class="toggle-switch" checked>
                            </div>
                            <div class="layer-toggle">
                                <label for="toggle-traffic" data-lang-key="traffic">Live Traffic</label>
                                <input type="checkbox" id="toggle-traffic" class="toggle-switch">
                            </div>
                        </div>
                        <hr>
                        <!-- NEW: POI Filters Section -->
                        <div class="map-options-section">
                            <h4>POI Filters</h4>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-heritage">Heritage</label>
                                <input type="checkbox" id="filter-poi-heritage" class="toggle-switch" data-poi-type="heritage" checked>
                            </div>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-historical">Historical</label>
                                <input type="checkbox" id="filter-poi-historical" class="toggle-switch" data-poi-type="historical_site" checked>
                            </div>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-religious">Religious</label>
                                <input type="checkbox" id="filter-poi-religious" class="toggle-switch" data-poi-type="religious_site" checked>
                            </div>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-natural">Nature</label>
                                <input type="checkbox" id="filter-poi-natural" class="toggle-switch" data-poi-type="natural_attraction" checked>
                            </div>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-park">Parks</label>
                                <input type="checkbox" id="filter-poi-park" class="toggle-switch" data-poi-type="park" checked>
                            </div>
                            <div class="poi-filter-toggle">
                                <label for="filter-poi-food">Food</label>
                                <input type="checkbox" id="filter-poi-food" class="toggle-switch" data-poi-type="food" checked>
                            </div>
                        </div>
                        <hr>
                        <div class="map-options-section">
                            <h4>Map Styles</h4>
                            <div class="style-options-grid">
                                <button class="style-option active" data-style="streets" data-lang-key="map_style_streets">Streets</button>
                                <button class="style-option" data-style="satellite" data-lang-key="map_style_satellite">Satellite</button>
                                <button class="style-option" data-style="dark" data-lang-key="map_style_dark">Dark</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Unified Search Container -->
        <div id="unified-search-container">
            <!-- UPDATED: New Search Bar Layout -->
            <div id="unified-search-bar">
                <div class="text-search-group">
                    <input type="text" id="unified-search-input" placeholder="Search for a place or ask AI...">
                    <button id="unified-search-action-btn" class="icon-button" title="Search">
                        <span class="material-icons">search</span>
                    </button>
                </div>
                <div class="search-separator"></div>
                <div class="other-methods-group">
                    <button id="unified-search-voice-btn" class="icon-button" title="Voice Search">
                        <span class="material-icons">mic</span>
                    </button>
                    <button id="map-pin-btn" class="icon-button" title="Choose on Map">
                        <span class="material-icons">place</span>
                    </button>
                    <button id="unified-search-ai-btn" class="icon-button" title="Ask AI">
                        <img id="unified-search-ai-avatar" src="https://i.imgur.com/r33W56s.png" alt="AI Persona">
                    </button>
                </div>
            </div>
            <div id="search-suggestions-panel" class="hidden">
                <!-- Suggestions will be populated here -->
            </div>
             <!-- This section will be shown when actively routing -->
            <div id="active-routing-panel" class="hidden">
                <div class="route-inputs">
                     <div class="input-group">
                        <div class="input-wrapper">
                             <span class="material-icons input-icon">trip_origin</span>
                            <input type="text" id="from-input" data-lang-key-placeholder="from_placeholder">
                        </div>
                    </div>
                     <div class="swap-locations-container">
                        <button id="swap-locations-btn" class="icon-button" data-lang-key-aria-label="swap_locations" title="Swap Locations">
                            <span class="material-icons">swap_vert</span>
                        </button>
                    </div>
                    <div class="input-group">
                        <div class="input-wrapper">
                            <span class="material-icons input-icon">flag</span>
                            <input type="text" id="to-input" data-lang-key-placeholder="to_placeholder">
                        </div>
                    </div>
                </div>
                <div id="route-preferences-bar">
                    <div class="route-pref-toggle">
                        <label for="route-pref-highways" data-lang-key="prefer_highways">Prefer Highways</label>
                        <input type="checkbox" id="route-pref-highways" class="toggle-switch">
                    </div>
                    <div class="route-pref-toggle">
                        <label for="route-pref-no-tolls" data-lang-key="avoid_tolls">Avoid Tolls</label>
                        <input type="checkbox" id="route-pref-no-tolls" class="toggle-switch">
                    </div>
                    <div class="route-pref-toggle">
                        <label for="route-pref-scenic" data-lang-key="prefer_scenic_route">Prefer Scenic</label>
                        <input type="checkbox" id="route-pref-scenic" class="toggle-switch">
                    </div>
                    <button id="open-route-prefs-btn" class="secondary-btn small-btn">Customize</button>
                </div>
                 <div class="route-actions">
                    <button id="find-route-btn" class="primary-btn"><span class="material-icons">directions</span></button>
                    <button id="clear-route-btn" class="secondary-btn"><span class="material-icons">close</span></button>
                </div>
            </div>
            <!-- NEW: Distance Measurement Display -->
            <div id="distance-measurement-display" class="hidden">
                <span>Total Distance: <strong id="distance-value">0.00 km</strong></span>
                <button id="distance-clear-btn" class="icon-button" title="Clear Measurement">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>
        
        <!-- NEW: Map Pin Selection UI -->
        <div id="map-pin-marker" class="hidden">
            <span class="material-icons">place</span>
        </div>
        <div id="map-pin-selection-ui" class="hidden">
            <p>Move the map to your desired location</p>
            <button id="confirm-pin-location-btn" class="primary-btn">Confirm Location</button>
            <button id="cancel-pin-location-btn" class="icon-button"><span class="material-icons">close</span></button>
        </div>

        <!-- NEW: Travel Time Panel -->
        <div id="travel-time-panel" class="hidden">
            <div class="panel-header">
                <h2>Travel Time Map</h2>
                <button id="travel-time-close-btn" class="icon-button"><span class="material-icons">close</span></button>
            </div>
            <div class="panel-content">
                <div class="setting-item-col">
                    <label for="travel-time-origin-input">Starting Point</label>
                    <div class="input-wrapper">
                         <span class="material-icons input-icon">trip_origin</span>
                        <input type="text" id="travel-time-origin-input" placeholder="Choose a starting point...">
                    </div>
                     <div class="origin-options">
                        <button id="travel-time-use-current-loc" class="secondary-btn">Use Current Location</button>
                        <button id="travel-time-pick-on-map" class="secondary-btn">Pick on Map</button>
                    </div>
                </div>
                <div class="setting-item-col">
                    <label>Travel Time Intervals (minutes)</label>
                    <div class="checkbox-group">
                        <div><input type="checkbox" id="tt-15" value="15" checked><label for="tt-15">15</label></div>
                        <div><input type="checkbox" id="tt-30" value="30" checked><label for="tt-30">30</label></div>
                        <div><input type="checkbox" id="tt-45" value="45"><label for="tt-45">45</label></div>
                        <div><input type="checkbox" id="tt-60" value="60"><label for="tt-60">60</label></div>
                    </div>
                </div>
                <div class="disclaimer">
                    <span class="material-icons">info</span>
                    <p>Estimates are based on straight-line distance ("as the crow flies") and an average speed, not actual road networks.</p>
                </div>
                <div class="panel-actions">
                    <button id="generate-travel-time-map-btn" class="primary-btn">Generate Map</button>
                    <button id="clear-travel-time-map-btn" class="secondary-btn">Clear</button>
                </div>
            </div>
        </div>

        <!-- NEW: Travel Time Legend -->
        <div id="travel-time-legend" class="hidden">
            <h4>Travel Time</h4>
            <ul>
                <li><span class="legend-color" style="background-color: rgba(46, 204, 113, 0.5);"></span>15 min</li>
                <li><span class="legend-color" style="background-color: rgba(241, 196, 15, 0.5);"></span>30 min</li>
                <li><span class="legend-color" style="background-color: rgba(230, 126, 34, 0.5);"></span>45 min</li>
                <li><span class="legend-color" style="background-color: rgba(231, 76, 60, 0.5);"></span>60 min</li>
            </ul>
        </div>

        <!-- NEW: Driver HUD -->
        <div id="driver-hud">
            <div id="speedometer" class="hud-widget">
                <span id="speed-value">--</span>
                <span class="hud-label">km/h</span>
            </div>
            <div id="compass" class="hud-widget">
                <div id="compass-needle"></div>
                <span class="hud-label">N</span>
            </div>
        </div>


        <!-- Live Camera Panel -->
        <div id="live-cam-panel" class="hidden">
            <div id="live-cam-header">
                 <span class="material-icons cam-status-icon">sensors</span>
                 <span class="cam-title">Live Cam</span>
                 <div class="cam-controls">
                    <button id="toggle-cam-analysis-btn" class="icon-button" title="Toggle AI Analysis"><span class="material-icons">visibility_off</span></button>
                    <button id="flip-cam-btn" class="icon-button" title="Flip Camera"><span class="material-icons">flip_camera_android</span></button>
                    <button id="close-cam-btn" class="icon-button" title="Close Camera"><span class="material-icons">close</span></button>
                 </div>
            </div>
            <div class="live-cam-body">
                <video id="live-cam-video" autoplay playsinline class="hidden"></video>
                <img id="ip-cam-stream" class="hidden" alt="IP Camera Stream"/>
                <canvas id="live-cam-overlay"></canvas>
                <div id="live-cam-placeholder">
                    <span class="material-icons">no_photography</span>
                    <p>Camera Unavailable</p>
                </div>
            </div>
        </div>
        
        <!-- Side Display Panel -->
        <div id="display-panel" class="collapsed">
            <div id="display-panel-header" class="panel-header">
                <h2 data-lang-key="display_panel_title">Nearby Information</h2>
                <div class="panel-header-controls">
                    <span class="material-icons panel-toggle-icon">expand_less</span>
                </div>
            </div>
            <div id="display-panel-content">
                <div id="display-panel-filters"></div>
                <div id="display-panel-list">
                    <p data-lang-key="no_items_found">No items found.</p>
                </div>
            </div>
        </div>

        <!-- Route Details Panel -->
        <div id="route-details-panel" class="hidden">
            <div id="route-loading-overlay" class="hidden">
                <div class="spinner"></div>
                <p data-lang-key="finding_best_routes">Finding the best routes for you...</p>
            </div>
             <div class="panel-header">
                <h2 data-lang-key="route_details">Route Details</h2>
                <button id="route-details-close" class="icon-button" data-lang-key-aria-label="close">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="route-summary">
                <div class="route-stat">
                    <span class="stat-label" data-lang-key="route_details_distance">Distance</span>
                    <span class="stat-value" id="route-distance">-- km</span>
                </div>
                <div class="route-stat">
                    <span class="stat-label" data-lang-key="route_details_time">Est. Time</span>
                    <span class="stat-value" id="route-time">-- min</span>
                </div>
                <div class="route-stat">
                    <span class="stat-label" data-lang-key="route_details_eta">ETA</span>
                    <span class="stat-value" id="route-eta">--:--</span>
                </div>
                 <div class="route-stat">
                    <span class="stat-label">Road Status</span>
                    <span class="stat-value" id="route-overall-status">--</span>
                </div>
            </div>
            <!-- NEW: AI Summary Section -->
            <div id="route-ai-summary-container" class="hidden">
                <div class="ai-summary-header">
                   <span class="material-icons">auto_awesome</span>
                   <h4>AI Route Summary</h4>
               </div>
               <p id="route-ai-summary"></p>
           </div>
            <!-- NEW: Alternative Routes Container -->
            <div id="route-alternatives-container" class="hidden">
                <h4>Alternative Routes</h4>
                <div id="route-alternatives">
                    <!-- Alternative route cards will be populated here by JS -->
                </div>
            </div>
            <div id="route-preferences-summary" class="hidden">
                <h4 data-lang-key="route_prefs_used">Route Preferences Used:</h4>
                <ul id="route-preferences-list"></ul>
            </div>
            <div class="directions-container">
                 <h3 id="route-directions-title" data-lang-key="route_details_directions">Directions</h3>
                 <div id="route-directions-list" class="directions-list"></div>
            </div>
            <div class="route-details-actions">
                 <button id="share-route-btn" class="secondary-btn icon-only" data-lang-key-aria-label="share_route" title="Share route"><span class="material-icons">share</span></button>
                 <button id="view-gmaps-btn" class="secondary-btn icon-only" data-lang-key-aria-label="view_on_gmaps"><span class="material-icons">map</span></button>
                 <button id="start-navigation-btn" class="primary-btn">
                    <span class="material-icons">navigation</span>
                    <span data-lang-key="start_navigation">Start Navigation</span>
                </button>
            </div>
        </div>

        <!-- Detail Card (for POIs, incidents, etc.) -->
        <aside id="detail-card">
            <div class="panel-header">
                <h2 id="detail-card-title"></h2>
                <button id="detail-card-close" class="icon-button" data-lang-key-aria-label="close">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="detail-card-content-wrapper">
                <div id="detail-card-content">
                    <!-- Main content injected by JS -->
                </div>
        
                <!-- Weather Sections -->
                <div id="detail-card-weather" class="hidden">
                    <span id="weather-icon" class="material-icons">cloud</span>
                    <div class="weather-info">
                        <span id="weather-temp">--Â°C</span>
                        <span id="weather-desc">--</span>
                    </div>
                </div>
                <div id="detail-card-forecast-container" class="hidden">
                    <!-- 3-day forecast injected by JS -->
                </div>
                <div id="detail-card-ai-advisory" class="hidden">
                    <div class="ai-summary-header">
                       <span class="material-icons">auto_awesome</span>
                       <h4>AI Weather Advisory</h4>
                   </div>
                   <div id="ai-advisory-content">
                       <!-- AI insight injected here -->
                   </div>
                </div>
            </div>
            <div id="detail-card-actions">
                <button class="primary-btn" id="directions-to-here-btn" data-lang-key="directions_to_here"><span class="material-icons">directions</span>Directions to here</button>
                <button class="secondary-btn" id="tell-me-more-btn" data-lang-key="tell_me_about_this_place"><span class="material-icons">chat</span>Tell me more</button>
            </div>
        </aside>
        
        <!-- Settings Panel (Off-canvas) -->
        <aside id="settings-panel">
            <div class="panel-header">
                <h2 data-lang-key="app_settings">App Settings</h2>
                <button class="icon-button" data-lang-key-aria-label="close">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="settings-content">
                 <div class="settings-section">
                    <h3 data-lang-key="ai_persona_title">AI Persona</h3>
                     <div class="persona-avatar-uploader">
                        <label for="persona-avatar-upload" data-lang-key-title="change_ai_avatar">
                            <img id="persona-avatar-preview" src="https://i.imgur.com/r33W56s.png" alt="AI Avatar">
                            <div class="upload-icon"><span class="material-icons">edit</span></div>
                        </label>
                        <input type="file" id="persona-avatar-upload" accept="image/png, image/jpeg, image/svg+xml" class="hidden">
                    </div>
                    <div class="setting-item-col">
                        <label for="persona-personality-select" data-lang-key="ai_personality_label">Personality</label>
                        <select id="persona-personality-select">
                            <option value="friendly" data-lang-key="personality_friendly">Friendly</option>
                            <option value="formal" data-lang-key="personality_formal">Formal</option>
                            <option value="guide" data-lang-key="personality_guide">Travel Guide</option>
                            <option value="buddy" data-lang-key="personality_buddy">Driver's Buddy</option>
                        </select>
                        <p id="persona-personality-description" class="setting-description"></p>
                    </div>
                    <div class="setting-item-col">
                        <label for="persona-relationship-select" data-lang-key="ai_relationship_label">Relationship</label>
                        <select id="persona-relationship-select">
                            <option value="friend" data-lang-key="relationship_friend">Friend</option>
                            <option value="partner" data-lang-key="relationship_partner">Partner</option>
                            <option value="husband" data-lang-key="relationship_husband">Husband</option>
                            <option value="wife" data-lang-key="relationship_wife">Wife</option>
                        </select>
                    </div>
                    <div class="setting-item-col">
                        <label for="persona-voice-select" data-lang-key="ai_voice_label">Voice</label>
                        <select id="persona-voice-select">
                            <option value="female" data-lang-key="voice_female">Female</option>
                            <option value="male" data-lang-key="voice_male">Male</option>
                            <option value="neutral" data-lang-key="voice_neutral">Neutral</option>
                        </select>
                    </div>
                 </div>
                 <div class="settings-section">
                    <h3 data-lang-key="preferences_title">Preferences</h3>
                    <div class="setting-item">
                        <label for="toggle-voice-response" data-lang-key="ai_voice_response">AI Voice Response</label>
                        <input type="checkbox" id="toggle-voice-response" class="toggle-switch" checked>
                    </div>
                 </div>
                 <!-- NEW: Offline Maps Section -->
                 <div class="settings-section">
                    <h3 data-lang-key="offline_maps_title">Offline Maps</h3>
                    <p class="setting-description" style="margin-top: -0.75rem; margin-bottom: 1rem;" data-lang-key="offline_maps_desc">Download map areas for use without an internet connection.</p>
                    <ul id="offline-regions-list">
                        <!-- Downloaded regions will be listed here -->
                    </ul>
                    <button id="add-offline-region-btn" class="primary-btn" style="width: 100%;">
                        <span class="material-icons">add</span>
                        <span data-lang-key="download_new_area">Download New Area</span>
                    </button>
                 </div>
            </div>
        </aside>

        <!-- Modals -->
        <div id="ai-chat-modal" class="hidden">
            <div class="chat-panel">
                <div class="panel-header chat-header">
                    <img id="chat-ai-avatar" src="https://i.imgur.com/r33W56s.png" alt="AI Avatar" class="ai-avatar">
                    <div class="ai-info">
                        <h2 id="chat-ai-name">Sadak Sathi</h2>
                        <span class="ai-status">Online</span>
                    </div>
                    <button id="close-chat-btn" class="icon-button" data-lang-key-aria-label="close_chat">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="chat-messages">
                    <!-- Messages will be added here -->
                </div>
                <div class="typing-indicator hidden"><span></span><span></span><span></span></div>
                <div class="chat-input-area">
                    <form id="chat-form">
                        <button type="button" id="voice-command-btn" class="icon-button" data-lang-key-aria-label="use_microphone" title="Use Microphone">
                            <span class="material-icons">mic</span>
                        </button>
                        <input type="text" id="chat-input" data-lang-key-placeholder="ai_chat_placeholder" autocomplete="off">
                        <button type="submit" class="icon-button" data-lang-key-aria-label="send_message" title="Send Message">
                            <span class="material-icons">send</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- NEW: Offline Maps Modal -->
        <div id="offline-maps-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3 data-lang-key="download_offline_map_title">Download Offline Map</h3>
                    <button id="offline-maps-close-btn" class="modal-close-btn icon-button"><span class="material-icons">close</span></button>
                </div>
                <ul id="download-region-options">
                    <li data-region="kathmandu">
                        <div class="region-info">
                            <strong data-lang-key="kathmandu_valley">Kathmandu Valley</strong>
                            <span data-lang-key="kathmandu_valley_desc">Capital city, heritage sites, and surrounding hills.</span>
                        </div>
                        <div class="region-actions">
                            <span class="region-size"></span>
                            <span class="status-text"></span>
                            <button class="secondary-btn small-btn download-btn"><span class="material-icons">download</span> <span data-lang-key="download">Download</span></button>
                            <button class="icon-button danger-btn delete-btn hidden" title="Delete map"><span class="material-icons">delete</span></button>
                        </div>
                    </li>
                    <li data-region="pokhara">
                        <div class="region-info">
                            <strong data-lang-key="pokhara">Pokhara</strong>
                            <span data-lang-key="pokhara_desc">Annapurna gateway, lakes, and city.</span>
                        </div>
                        <div class="region-actions">
                            <span class="region-size"></span>
                             <span class="status-text"></span>
                            <button class="secondary-btn small-btn download-btn"><span class="material-icons">download</span> <span data-lang-key="download">Download</span></button>
                            <button class="icon-button danger-btn delete-btn hidden" title="Delete map"><span class="material-icons">delete</span></button>
                        </div>
                    </li>
                    <li data-region="chitwan">
                        <div class="region-info">
                            <strong data-lang-key="chitwan">Chitwan National Park</strong>
                            <span data-lang-key="chitwan_desc">Wildlife, jungles, and the Terai plains.</span>
                        </div>
                        <div class="region-actions">
                            <span class="region-size"></span>
                             <span class="status-text"></span>
                            <button class="secondary-btn small-btn download-btn"><span class="material-icons">download</span> <span data-lang-key="download">Download</span></button>
                            <button class="icon-button danger-btn delete-btn hidden" title="Delete map"><span class="material-icons">delete</span></button>
                        </div>
                    </li>
                    <li data-region="lumbini">
                        <div class="region-info">
                            <strong data-lang-key="lumbini">Lumbini</strong>
                            <span data-lang-key="lumbini_desc">Birthplace of Lord Buddha and monasteries.</span>
                        </div>
                        <div class="region-actions">
                            <span class="region-size"></span>
                             <span class="status-text"></span>
                            <button class="secondary-btn small-btn download-btn"><span class="material-icons">download</span> <span data-lang-key="download">Download</span></button>
                            <button class="icon-button danger-btn delete-btn hidden" title="Delete map"><span class="material-icons">delete</span></button>
                        </div>
                    </li>
                     <li data-region="everest">
                        <div class="region-info">
                            <strong data-lang-key="everest_region">Everest Region</strong>
                            <span data-lang-key="everest_region_desc">Sagarmatha National Park and high Himalayas.</span>
                        </div>
                        <div class="region-actions">
                            <span class="region-size"></span>
                            <span class="status-text"></span>
                            <button class="secondary-btn small-btn download-btn"><span class="material-icons">download</span> <span data-lang-key="download">Download</span></button>
                            <button class="icon-button danger-btn delete-btn hidden" title="Delete map"><span class="material-icons">delete</span></button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- NEW: Share Route Modal -->
        <div id="share-route-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3 data-lang-key="share_route_title">Share Route</h3>
                    <button id="share-route-close-btn" class="modal-close-btn icon-button"><span class="material-icons">close</span></button>
                </div>
                <div class="share-content">
                    <label for="share-route-link">Share this link with others:</label>
                    <div class="share-link-wrapper">
                        <input type="text" id="share-route-link" readonly>
                        <button id="copy-share-link-btn" class="primary-btn">
                            <span class="material-icons">content_copy</span>
                            <span data-lang-key="copy_link">Copy Link</span>
                        </button>
                    </div>
                    <div class="share-options">
                        <a id="share-email-btn" href="#" target="_blank" class="share-option-btn">
                            <span class="material-icons">email</span> <span data-lang-key="share_via_email">Email</span>
                        </a>
                        <a id="share-x-btn" href="#" target="_blank" class="share-option-btn">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                             <span data-lang-key="share_on_x">X</span>
                        </a>
                        <a id="share-facebook-btn" href="#" target="_blank" class="share-option-btn">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04c-5.5 0-10 4.49-10 10.02 0 5 3.66 9.15 8.44 9.9v-7.02H7.97v-2.89H10.4v-2.16c0-2.42 1.44-3.76 3.67-3.76 1.05 0 2.15.19 2.15.19v2.47h-1.26c-1.18 0-1.55.71-1.55 1.48v1.8h2.77l-.44 2.89h-2.33v7.02c4.77-.75 8.44-4.9 8.44-9.9C22 6.53 17.5 2.04 12 2.04z"/></svg>
                            <span data-lang-key="share_on_facebook">Facebook</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div id="route-options-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 data-lang-key="route_options_title">Route Options</h3>
                <button class="modal-close-btn icon-button" data-lang-key-aria-label="close"><span class="material-icons">close</span></button>
                <div id="route-options-list"></div>
            </div>
        </div>
        
        <div id="app-mode-modal" class="modal-overlay hidden">
            <div class="modal-content">
                 <h3 data-lang-key="select_mode">Select Mode</h3>
                 <button class="modal-close-btn icon-button" data-lang-key-aria-label="close"><span class="material-icons">close</span></button>
                 <div class="mode-selection">
                    <button class="mode-select-btn" data-mode="driving">
                        <span class="material-icons">directions_car</span>
                        <span data-lang-key="mode_driving">Driving</span>
                    </button>
                     <button class="mode-select-btn" data-mode="riding">
                        <span class="material-icons">two_wheeler</span>
                        <span data-lang-key="mode_riding">Riding</span>
                    </button>
                     <button class="mode-select-btn" data-mode="exploring">
                        <span class="material-icons">explore</span>
                        <span data-lang-key="mode_exploring">Exploring</span>
                    </button>
                     <button class="mode-select-btn" data-mode="connect">
                        <span class="material-icons">hub</span>
                        <span data-lang-key="mode_connect">Connect</span>
                    </button>
                 </div>
            </div>
        </div>

        <!-- NEW: Route Preferences Modal -->
        <div id="route-preferences-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3>Route Preferences</h3>
                    <button id="route-prefs-close-btn" class="modal-close-btn icon-button"><span class="material-icons">close</span></button>
                </div>
                <div class="route-prefs-list">
                    <div class="route-prefs-item">
                        <div class="route-prefs-info">
                            <label for="modal-pref-highways">Prefer Highways</label>
                            <p class="setting-description">Prioritizes major roads and highways for faster travel times.</p>
                        </div>
                        <input type="checkbox" id="modal-pref-highways" class="toggle-switch">
                    </div>
                    <div class="route-prefs-item">
                        <div class="route-prefs-info">
                            <label for="modal-pref-no-tolls">Avoid Tolls</label>
                            <p class="setting-description">Finds routes that do not require toll payments.</p>
                        </div>
                        <input type="checkbox" id="modal-pref-no-tolls" class="toggle-switch">
                    </div>
                    <div class="route-prefs-item">
                        <div class="route-prefs-info">
                            <label for="modal-pref-scenic">Prefer Scenic Route</label>
                            <p class="setting-description">Highlights routes with better scenery, which may take longer.</p>
                        </div>
                        <input type="checkbox" id="modal-pref-scenic" class="toggle-switch">
                    </div>
                    <div class="route-prefs-item">
                        <div class="route-prefs-info">
                            <label for="modal-pref-less-crowded">Find Less Crowded Roads</label>
                            <p class="setting-description">Attempts to find routes that avoid heavy traffic and congestion.</p>
                        </div>
                        <input type="checkbox" id="modal-pref-less-crowded" class="toggle-switch">
                    </div>
                    <div class="route-prefs-item">
                        <div class="route-prefs-info">
                            <label for="modal-pref-avoid-unpaved">Avoid Unpaved Roads</label>
                            <p class="setting-description">Generates routes that stick to paved roads where possible.</p>
                        </div>
                        <input type="checkbox" id="modal-pref-avoid-unpaved" class="toggle-switch">
                    </div>
                </div>
                <div class="form-actions">
                    <button id="route-prefs-cancel-btn" class="secondary-btn">Cancel</button>
                    <button id="route-prefs-save-btn" class="primary-btn">Save & Reroute</button>
                </div>
            </div>
        </div>

        <div id="profile-modal" class="modal-overlay hidden">
             <div class="modal-content">
                <button class="modal-close-btn icon-button" data-lang-key-aria-label="close"><span class="material-icons">close</span></button>

                <!-- Login View -->
                <div id="login-view">
                     <h3>Welcome Back!</h3>
                     <p class="modal-subtitle">Log in to sync your preferences.</p>
                     <form id="login-form">
                        <input type="email" id="login-email" placeholder="Enter your email" required>
                        <button type="submit" class="primary-btn">Continue</button>
                     </form>
                     <div id="login-error-message" class="error-message hidden"></div>
                </div>

                <!-- OTP View (repurposed for password) -->
                <div id="otp-view" class="hidden">
                    <h3>Enter Your Password</h3>
                    <p class="modal-subtitle">Enter password for <b id="otp-email-display"></b>. If you are new, a new account will be created.</p>
                     <form id="otp-form">
                        <input type="password" id="otp-input" placeholder="******" required>
                        <button type="submit" class="primary-btn">Log In or Sign Up</button>
                     </form>
                    <div id="otp-error-message" class="error-message hidden"></div>
                </div>

                <!-- Profile View -->
                <div id="profile-view" class="hidden">
                    <div class="profile-header">
                        <img id="profile-avatar" src="https://i.imgur.com/uGAtGpj.png" alt="User Avatar">
                        <div class="profile-info">
                            <span id="profile-email">user@example.com</span>
                            <span id="profile-role-badge" data-role="user">user</span>
                        </div>
                    </div>
                    <div class="profile-actions">
                         <button id="open-settings-btn" class="secondary-btn">
                             <span class="material-icons">settings</span>
                             <span data-lang-key="app_settings">App Settings</span>
                         </button>
                         <button id="admin-dashboard-btn" class="secondary-btn hidden">
                             <span class="material-icons">admin_panel_settings</span>
                             <span>Admin Dashboard</span>
                         </button>
                         <button id="superadmin-settings-btn" class="secondary-btn hidden">
                            <span class="material-icons">manage_accounts</span>
                            <span>Superadmin Settings</span>
                        </button>
                         <button id="logout-btn" class="danger-btn">
                             <span class="material-icons">logout</span>
                             <span>Log Out</span>
                         </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NEW: Admin Dashboard Modal -->
        <div id="admin-dashboard-modal" class="modal-overlay hidden">
            <div class="modal-content admin-panel"> <!-- Re-use admin-panel for large modal style -->
                <div class="panel-header">
                    <h2>Admin Dashboard</h2>
                    <button id="admin-dashboard-close-btn" class="icon-button"><span class="material-icons">close</span></button>
                </div>
                <div class="admin-panel-body">
                    <div class="admin-tabs">
                        <button class="admin-tab-btn active" data-tab="pending">Pending Reports <span id="pending-reports-badge" class="badge hidden"></span></button>
                        <button class="admin-tab-btn" data-tab="jurisdiction">My Jurisdiction</button>
                    </div>
                    <div class="admin-tab-content active" data-tab-content="pending">
                        <div id="pending-reports-list" class="report-list-container">
                             <!-- Pending reports will be rendered here -->
                        </div>
                    </div>
                    <div class="admin-tab-content" data-tab-content="jurisdiction">
                        <div id="jurisdiction-reports-list" class="report-list-container">
                            <!-- Jurisdiction reports will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Admin Approve/Relay Form Modal -->
        <div id="admin-form-modal" class="modal-overlay hidden">
            <div class="modal-content admin-form-modal-content">
                 <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3 id="admin-form-title">Review Incident Report</h3>
                    <button id="admin-form-close-btn" class="modal-close-btn icon-button"><span class="material-icons">close</span></button>
                </div>
                <form id="admin-edit-form">
                    <div class="admin-form-columns">
                        <div id="admin-form-fields" class="admin-form-fields-grid">
                            <!-- Form fields will be dynamically generated here -->
                        </div>
                        <div class="admin-form-map-container">
                            <label>Pin Location</label>
                            <div id="admin-form-map"></div>
                        </div>
                    </div>
                    <!-- NEW: AI Assistant Bar -->
                    <div id="admin-form-ai-assistant">
                        <button type="button" id="admin-form-mic-btn" class="icon-button" title="Use Voice Commands">
                            <span class="material-icons">mic</span>
                        </button>
                        <p id="admin-form-ai-status">AI Assistant ready. Say "Fill description..." or "Pin location".</p>
                    </div>
                    <div class="form-actions">
                         <button type="button" id="admin-form-cancel-btn" class="secondary-btn">Cancel</button>
                         <button type="submit" class="primary-btn">Approve & Post Incident</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- NEW: Admin Relay Modal -->
        <div id="admin-relay-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 id="admin-relay-title">Relay Incident</h3>
                <p>Forward this report to the correct jurisdiction.</p>
                <div class="setting-item-col">
                    <label for="relay-jurisdiction-select">Select Jurisdiction</label>
                    <select id="relay-jurisdiction-select">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="form-actions">
                    <button id="admin-relay-cancel-btn" class="secondary-btn">Cancel</button>
                    <button id="admin-relay-confirm-btn" class="primary-btn">Confirm & Relay</button>
                </div>
            </div>
        </div>

        <div id="report-incident-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3 data-lang-key="report_incident_title">Report New Road Incident</h3>
                    <button id="report-incident-close" class="modal-close-btn icon-button" data-lang-key-aria-label="close">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div id="report-location-unavailable" class="hidden">
                    <p data-lang-key="report_location_unavailable">Your current location is not available. Please enable GPS to report an incident.</p>
                </div>
                <form id="report-incident-form" class="hidden">
                    <div class="setting-item-col" style="margin-bottom: 1rem;">
                        <label for="incident-location" data-lang-key="location">Location</label>
                        <div class="input-wrapper">
                            <span class="material-icons input-icon">my_location</span>
                            <input type="text" id="incident-location" disabled data-lang-key-placeholder="current_location">
                        </div>
                    </div>
                    <div class="setting-item-col" style="margin-bottom: 1rem;">
                        <label for="incident-time">Time of Report</label>
                        <div class="input-wrapper">
                            <span class="material-icons input-icon">schedule</span>
                            <input type="text" id="incident-time" disabled>
                        </div>
                    </div>
                    <div class="setting-item-col" style="margin-bottom: 1rem;">
                        <label for="incident-type" data-lang-key="incident_type">Type of Incident</label>
                        <select id="incident-type" required>
                            <option value="Accident" data-lang-key="incident_type_accident">Accident</option>
                            <option value="Roadblock" data-lang-key="incident_type_roadblock">Roadblock</option>
                            <option value="Construction" data-lang-key="incident_type_construction">Construction</option>
                            <option value="Hazard" data-lang-key="incident_type_hazard">Hazard</option>
                            <option value="Traffic Jam" data-lang-key="incident_type_traffic">Traffic Jam</option>
                            <option value="Flood">Flood</option>
                            <option value="Landslide">Landslide</option>
                            <option value="Broken Road/Bridge">Broken Road/Bridge</option>
                            <option value="Other" data-lang-key="incident_type_other">Other</option>
                        </select>
                    </div>
                    <div class="setting-item-col" style="margin-bottom: 1rem;">
                        <label for="incident-description" data-lang-key="description">Description (Optional)</label>
                        <textarea id="incident-description" rows="3" data-lang-key-placeholder="incident_desc_placeholder"></textarea>
                    </div>
                    <div class="setting-item-col">
                        <label for="incident-photo-upload">Upload Photo (Optional)</label>
                        <input type="file" id="incident-photo-upload" accept="image/*">
                        <div id="incident-image-preview-container" class="image-preview-container hidden" style="margin-top: 1rem;">
                            <img id="incident-image-preview" src="#" alt="Incident image preview">
                        </div>
                    </div>
                    <button type="submit" class="primary-btn" style="width: 100%; margin-top: 1rem;" data-lang-key="submit_report">Submit Report</button>
                </form>
            </div>
        </div>

        <!-- NEW: Find My Car Modal -->
        <div id="find-car-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="panel-header" style="padding: 0 0 1.5rem 0;">
                    <h3 data-lang-key="find_my_car_modal_title">Find My Car</h3>
                    <button id="find-car-close-btn" class="modal-close-btn icon-button"><span class="material-icons">close</span></button>
                </div>
                <div id="find-car-content">
                    <div id="no-car-location-view">
                        <p data-lang-key="car_location_not_saved">You haven't saved your car's location yet.</p>
                        <button id="park-here-btn" class="primary-btn">
                            <span class="material-icons">local_parking</span>
                            <span data-lang-key="park_here">Park Here</span>
                        </button>
                    </div>
                    <div id="car-location-saved-view" class="hidden">
                        <p data-lang-key="car_location_saved_at">Your car is parked at:</p>
                        <strong id="saved-car-address" data-lang-key="fetching_address">Fetching address...</strong>
                        <div class="car-location-actions">
                            <button id="get-directions-to-car-btn" class="primary-btn">
                                <span class="material-icons">directions</span>
                                <span data-lang-key="get_directions">Get Directions</span>
                            </button>
                            <button id="clear-car-location-btn" class="secondary-btn">
                                <span class="material-icons">delete</span>
                                <span data-lang-key="clear_location">Clear Location</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Pre-Permission Modal -->
        <div id="pre-permission-modal" class="modal-overlay hidden">
            <div class="modal-content">
                 <h3 id="pre-permission-title">Feature Requires Permission</h3>
                 <p id="pre-permission-text">To use this feature, Sadak Sathi needs your permission. The browser will ask you to confirm next.</p>
                 <div class="form-actions">
                    <button id="pre-permission-deny-btn" class="secondary-btn">Not Now</button>
                    <button id="pre-permission-grant-btn" class="primary-btn">Continue</button>
                 </div>
            </div>
        </div>

        <!-- UPDATED: Permission Help Modal -->
        <div id="permission-help-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <button id="permission-modal-close-btn" class="modal-close-btn icon-button" data-lang-key-aria-label="close"><span class="material-icons">close</span></button>
                <h3 id="permission-help-title">Permission Blocked</h3>
                <p id="permission-help-text">To use this feature, you need to allow access in your browser's address bar settings.</p>
                <div class="permission-animation">
                    <svg viewBox="0 0 300 80" class="permission-svg">
                        <!-- Address Bar -->
                        <rect x="10" y="10" width="280" height="40" rx="5" fill="#f1f3f4"/>
                        <circle cx="25" cy="30" r="5" fill="#ed6a5e"/>
                        <circle cx="45" cy="30" r="5" fill="#f4be4f"/>
                        <circle cx="65" cy="30" r="5" fill="#61c554"/>
                        
                        <!-- Lock Icon -->
                        <g id="lock-icon" transform="translate(80 22)">
                            <rect x="2" y="5" width="12" height="9" rx="1" fill="#5f6368"/>
                            <path d="M4,5 V3 C4,1.34 5.34,0 7,0 h2 c1.66,0 3,1.34 3,3 v2" stroke="#5f6368" stroke-width="2" fill="none"/>
                        </g>
                        
                        <!-- Text -->
                        <text x="105" y="35" font-family="sans-serif" font-size="14" fill="#3c4043">sadak-sathi.app</text>
                        
                        <!-- Hand Cursor -->
                        <g id="hand-cursor" transform="translate(85, 40)">
                             <path d="M6.51,25.74,7.86,12.39a1.5,1.5,0,0,0-3,0L3.49,25.74" fill="#f4c57c" stroke="#5c4a3a" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M12.51,25.74,13.86,12.39a1.5,1.5,0,0,0-3,0L9.49,25.74" fill="#f4c57c" stroke="#5c4a3a" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M18.51,25.74,19.86,12.39a1.5,1.5,0,0,0-3,0L15.49,25.74" fill="#f4c57c" stroke="#5c4a3a" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M24.51,25.74,25.86,12.39a1.5,1.5,0,0,0-3,0L21.49,25.74" fill="#f4c57c" stroke="#5c4a3a" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M4.6,18.15a2,2,0,0,0-2.3-1.63,2,2,0,0,0-1.63,2.3l2.3,6.9a2,2,0,0,0,2.3,1.63,2,2,0,0,0,1.63-2.3Z" fill="#f4c57c" stroke="#5c4a3a" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- UPDATED: Reports Modal -->
        <div id="reports-modal" class="modal-overlay hidden">
            <div class="modal-content admin-panel"> <!-- Re-use admin-panel for large modal style -->
                <div class="panel-header">
                    <h2>Archived Incident Reports</h2>
                    <button id="reports-close-btn" class="icon-button"><span class="material-icons">close</span></button>
                </div>
                <div class="admin-panel-body">
                    <!-- NEW: Main Controls Wrapper -->
                    <div class="report-main-controls">
                        <!-- Filters -->
                        <div class="report-filters-container">
                            <!-- Report Type -->
                            <div class="report-control-group">
                                <h4>Report Type</h4>
                                <div class="report-type-toggles">
                                    <button class="secondary-btn report-type-btn" data-type="snapshot">Daily Snapshot</button>
                                    <button class="secondary-btn report-type-btn active" data-type="resumption">Resumption Log</button>
                                </div>
                            </div>
                             <!-- Date Filters -->
                            <div class="report-control-group">
                                <h4>Date Range</h4>
                                <div class="report-date-filters">
                                    <button class="secondary-btn report-date-btn" data-range="today">Today</button>
                                    <button class="secondary-btn report-date-btn" data-range="week">This Week</button>
                                    <button class="secondary-btn report-date-btn active" data-range="month">This Month</button>
                                    <div class="custom-date-range">
                                        <input type="date" id="report-date-start">
                                        <span>to</span>
                                        <input type="date" id="report-date-end">
                                    </div>
                                </div>
                            </div>
                             <!-- Highway Filter -->
                            <div class="report-control-group">
                                <h4>Filter by Highway</h4>
                                <div id="highway-filter-container">
                                    <!-- Checkboxes will be populated here -->
                                    <p>Loading highways...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Views and Actions -->
                        <div class="report-views-actions-container">
                             <!-- View Toggles -->
                            <div class="report-control-group">
                                <h4>View As</h4>
                                <div class="report-view-toggles">
                                    <button class="icon-button report-view-btn" data-view="card" title="Card View"><span class="material-icons">view_carousel</span></button>
                                    <button class="icon-button report-view-btn active" data-view="table" title="Table View"><span class="material-icons">table_rows</span></button>
                                    <button class="icon-button report-view-btn" data-view="chart" title="Chart View"><span class="material-icons">bar_chart</span></button>
                                </div>
                            </div>
                             <!-- Actions -->
                            <div class="report-control-group">
                                <h4>Actions</h4>
                                <div class="report-actions-group">
                                    <button id="download-pdf-btn" class="secondary-btn">
                                        <span class="material-icons">picture_as_pdf</span> PDF
                                    </button>
                                    <button id="print-report-btn" class="secondary-btn">
                                        <span class="material-icons">print</span> Print
                                    </button>
                                    <button id="download-csv-btn" class="secondary-btn">
                                        <span class="material-icons">download</span> CSV
                                    </button>
                                    <button id="share-report-btn" class="secondary-btn">
                                        <span class="material-icons">share</span> Copy
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="report-summary">
                        <h4 id="report-summary-text">Total Resumed Incidents: <span id="report-total-count">0</span></h4>
                    </div>
                    <div class="report-content">
                        <div id="report-chart-view" class="hidden">
                            <canvas id="reports-chart"></canvas>
                        </div>
                        <div id="report-table-view">
                            <table class="admin-data-table reports-table">
                                <thead>
                                    <tr>
                                        <th>Highway</th>
                                        <th>Incident Type</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Jurisdiction</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be injected here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- NEW: Added Card View structure -->
                        <div id="report-card-view" class="hidden">
                            <div id="report-card-container">
                                 <!-- Card will be injected here -->
                            </div>
                            <div id="report-card-navigation">
                                <button id="report-card-prev" class="icon-button" title="Previous Incident">
                                    <span class="material-icons">arrow_back_ios</span>
                                </button>
                                <span id="report-card-counter">0 / 0</span>
                                <button id="report-card-next" class="icon-button" title="Next Incident">
                                    <span class="material-icons">arrow_forward_ios</span>
                                </button>
                            </div>
                        </div>
                         <div id="report-no-data" class="hidden">
                            <p>No data available for the selected period.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Superadmin Settings Modal -->
        <div id="superadmin-settings-modal" class="modal-overlay hidden">
             <div class="modal-content admin-panel">
                <div class="panel-header">
                    <h2>Superadmin Control Panel</h2>
                    <button id="superadmin-settings-close-btn" class="icon-button"><span class="material-icons">close</span></button>
                </div>
                <div class="admin-panel-body">
                    <div class="admin-tabs">
                        <button class="admin-tab-btn active" data-tab="report-settings">Report Settings</button>
                        <button class="admin-tab-btn" data-tab="system-logs">System Logs</button>
                    </div>
                    <div id="report-settings-content" class="admin-tab-content active">
                        <form id="superadmin-settings-form">
                            <div class="setting-item-col">
                                <label for="report-header-1">Report Header Line 1</label>
                                <input type="text" id="report-header-1" name="reportHeader1">
                            </div>
                             <div class="setting-item-col">
                                <label for="report-header-2">Report Header Line 2</label>
                                <input type="text" id="report-header-2" name="reportHeader2">
                            </div>
                             <div class="setting-item-col">
                                <label for="report-header-3">Report Header Line 3</label>
                                <input type="text" id="report-header-3" name="reportHeader3">
                            </div>
                             <div class="setting-item-col">
                                <label for="report-header-4">Report Header Line 4</label>
                                <input type="text" id="report-header-4" name="reportHeader4">
                            </div>
                            <div class="setting-item-col">
                                <label for="report-copyright">Copyright Text</label>
                                <input type="text" id="report-copyright" name="copyrightText">
                            </div>
                             <div class="setting-item-col">
                                <label for="report-permission">Report Generation Permission</label>
                                <select id="report-permission" name="reportPermission">
                                    <option value="admins_only">Admins Only</option>
                                    <option value="logged_in_users">All Logged-in Users</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="primary-btn">Save Settings</button>
                            </div>
                        </form>
                    </div>
                    <div id="system-logs-content" class="admin-tab-content">
                        <div id="system-logs-container">
                            <pre id="system-logs-pre"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification Container -->
        <div id="toast-container"></div>
        
        <!-- Offline/Online Status Indicator -->
        <div id="offline-indicator" class="hidden">
            <span class="material-icons">wifi_off</span>
            <span data-lang-key="you_are_offline">You are offline. Using downloaded maps.</span>
        </div>
        
        <!-- Firebase API Key Missing Error -->
        <div id="config-error" style="display: none;">
            <div class="config-error-content">
                <span class="material-icons error-icon">error</span>
                <h2>Configuration Error</h2>
                <p>The application is missing a necessary configuration. Please ensure the Firebase API keys are set up correctly in <code>index.html</code>.</p>
                <p>This is a safety measure to prevent accidental exposure of sensitive keys in a real-world scenario.</p>
            </div>
        </div>

    </div>
    
    <!-- This is a development-only configuration. In production, this would be handled by a secure backend. -->
    <script>
      // IMPORTANT: In a real production app, this Firebase config would NOT be here.
      // It would be handled by a secure backend and environment variables.
      // For this interactive demo, it is included here for functionality.
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY_HERE", // Replace with your actual Firebase API key
        authDomain: "your-project-id.firebaseapp.com",
        projectId: "your-project-id",
        storageBucket: "your-project-id.appspot.com",
        messagingSenderId: "your-sender-id",
        appId: "your-app-id"
      };
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <script type="module" src="index.tsx"></script>
</body>
</html>